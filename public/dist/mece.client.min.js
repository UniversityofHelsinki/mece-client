var meceClientApp=function(){"use strict";function e(e,n){if("undefined"!=typeof moment)return moment(e).locale(n).calendar()}function n(e){oe&&console.log("module: MECE-CLIENT -- "+e+" : "+Date().toString())}function t(){ae(document).ready(function(){D=ae(ie).append(ce),Y=D.find(".mece"),M=Y.find(".mece-content"),S=Y.find(".mece-icon"),Q=Y.find(".mece-badge"),N=Y.find(".mece-row-container--no-messages"),I=ae("#mece-mobile-cover"),a(),m(),b(),j(),o()})}function i(e){Q.text(e)}function a(){n("initializerStuff in"),u();var e=D.data("language");!e||"fi"!==e&&"sv"!==e&&"en"!==e||(z=e),v(),n("initializerStuff out")}function o(){n("start"),s(),x(),setInterval(function(){s(),x()},W)}function s(){n("fetchNotifications"),c().done(function(e){r(e),p()}).fail(function(e){n("ERROR "+JSON.stringify(e)),h()})}function c(){var e={};"0"!==A&&(e.startingTime=A),e.token=F,e.host=H;var t=U+"/mece/api/notifications?"+ae.param(e);return ae.ajax({url:t,type:"GET",crossDomain:!0,dataType:"json",xhrFields:{withCredentials:!0},success:function(e){return _+=e.length,e},error:function(e,t,i){n(e.responseText)}})}function r(e){var n,t=e;t&&t.length>0&&d(t),t.sort(function(e,n){return new Date(e.submitted)-new Date(n.submitted)}),t.length>0&&C(t.map(function(e){return n={en:{heading:e.headingEN,message:e.messageEN,linkUrl:e.linkUrlEN,linkText:e.linkTextEN},fi:{heading:e.headingFI,message:e.messageFI,linkUrl:e.linkUrlFI,linkText:e.linkTextFI},sv:{heading:e.headingSV,message:e.messageSV,linkUrl:e.linkUrlSV,linkText:e.linkTextSV}},[e._id,e.message,e.linkUrl,e.linkText,e.heading,e.avatarImageUrl,e.received,R?n:{en:{},fi:{},sv:{}},e.submitted,e.read]}))}function d(e){ae.each(e,function(e,n){A<n.received&&(A=n.received)})}function l(){var e=D.data("polling-interval");return e&&e>W?e:W}function m(){W=l(),U=D.data("domain")||q,H=D.data("host")||B,F=D.data("token"),oe=D.data("enable-debug")||!1}function u(){if(void 0===window.moment){var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src","https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment-with-locales.min.js"),(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(e)}}function f(){var e;void 0===window.jQuery||window.jQuery.fn.jquery!==V?(e=document.createElement("script"),e.setAttribute("type","text/javascript"),e.setAttribute("src","https://ajax.googleapis.com/ajax/libs/jquery/"+V+"/jquery.min.js"),e.readyState?e.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(ae=window.jQuery.noConflict(!0),n("jQuery loaded"),t())}:e.onload=function(){ae=window.jQuery.noConflict(!0),n("browsers"),t()},(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(e)):(ae=window.jQuery,n("The jQuery version on the window is the one we want to use"),t())}function v(){function e(){"undefined"!=typeof moment?(moment.locale("fi",{calendar:{sameDay:function(){return"["+moment(this).locale("fi").fromNow()+"]"},nextDay:"[huomenna] [klo] LT",nextWeek:"dddd [klo] LT",lastDay:"[eilen] [klo] LT",lastWeek:"[viime] dddd[na] [klo] LT",sameElse:"L"}}),moment.locale("sv",{calendar:{sameDay:function(){return"["+moment(this).locale("sv").fromNow()+"]"},nextDay:"[Imorgon] LT",lastDay:"[Igår] LT",nextWeek:"[På] dddd LT",lastWeek:"[I] dddd[s] LT",sameElse:"L"}}),moment.locale("en",{calendar:{sameDay:function(){return"["+moment(this).locale("en").fromNow()+"]"},nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"}}),x()):setTimeout(function(){e()},250)}e()}function g(e,t){var i=te[e][t||z];return n("Translation: "+i),i}function p(){Y.toggleClass("mece--no-messages",0===k()),N.html(g("no_messages")),w(!1)}function h(){Y.toggleClass("mece--no-messages",!0),N.html(g("no_messages"))}function w(e){var n=y().filter(":not(.mece-row-container--read)").length-1;Y.toggleClass("mece--has-unreads",0!==n),i(n)}function k(){return y().length-1}function y(){return M.children(".mece-row-container")}function x(){M.children(".mece-row-container").each(function(){var n=ae(this).find(".mece-hidden-submitted-time").first().text(),t=ae(this).find("."+ne).first();t&&n&&t.text(e(n,z))})}function T(e,t){n("Seeking field "+e+" for language "+z);var i={fi:"sv",sv:"en",en:"fi"},a=z,o=t[X][a][e];return o&&"undefined"!==o||(a=i[a],o=t[X][a][e]),o&&"undefined"!==o||(a=i[a],o=t[X][a][e]),o}function L(n){var t=function(){var e=ee+"/avatar.png",t=n[K];return t||e},i=T("linkUrl",n)||n[P],a=T("message",n)||n[O],o=T("heading",n)||n[J];i=void 0===i||"undefined"===i?"":i,a=void 0===a||"undefined"===a?"&nbsp;":a,o=void 0===o||"undefined"===o?"&nbsp;":o;var s=String.format(re,n[G],t(),i,o,a,e(n[Z],z),n[Z],n[$]?" mece-row-container--read":"",n[$]?"mece-para-ellipsis--read":"mece-para-ellipsis");M.prepend(s)}function j(){M.on("click",".mece-row-container",function(){var e=ae(this);if(!e.hasClass("mece-row-container--read")&&!e.hasClass("mece-row-container--no-messages")){var n={};n.token=F,n.id=this.id,n.host=H;var t=U+"/mece/api/notifications/markRead?"+ae.param(n);ae.ajax({url:t,type:"GET",crossDomain:!0,dataType:"json",xhrFields:{withCredentials:!0},success:function(n){e.addClass("mece-row-container--read"),e.find(".mece-para-ellipsis").toggleClass("mece-para-ellipsis--read"),w(!1)},error:function(e,n,t){console.log(e.responseText)}})}})}function b(){S.click(function(e){e.stopPropagation(),Y.toggleClass("mece--open"),I.toggleClass("mece-mobile-cover--visible")})}function C(e){ae.each(e,function(e,n){L(n)})}function E(){se||(n("loading widget"),f(),se=!0)}var D,Y,M,S,N,I,U,H,F,Q,W=6e4,_=0,A="0",R=!0,V="1.11.3",q="https://mece.it.helsinki.fi",B="opintoni",z="fi",G=0,O=1,P=2,J=4,K=5,X=7,Z=8,$=9,ee="https://mece.it.helsinki.fi/dist/prod/images",ne="mece-row-content-received",te={no_messages:{en:"No messages",fi:"Ei viestejä",sv:"Inga meddelanden"}},ie="#mece",ae=null,oe=!1,se=!1;String.format=function(){for(var e=arguments[0],n=0;n<arguments.length-1;n++){var t=new RegExp("\\{"+n+"\\}","gm");e=e.replace(t,arguments[n+1])}return e};var ce='<div class="mece">            <div class="mece-icon">                <img src="https://mece.it.helsinki.fi/dist/prod/images/bell.svg">                <div class="mece-badge"></div>            </div>            <div class="mece-icon mece-icon-close">                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"                    viewBox="-16 -16 62 62" enable-background="new 0 0 62 62" xml:space="preserve">                    <polygon fill="#fff" points="19.1,15.5 29.2,5.3 29.9,4.6 29.2,3.9 27.1,1.8 26.4,1.1 25.7,1.8 15.5,11.9 5.3,1.8 4.6,1.1                    3.9,1.8 1.8,3.9 1.1,4.6 1.8,5.3 11.9,15.5 1.8,25.7 1.1,26.4 1.8,27.1 3.9,29.2 4.6,29.9 5.3,29.2 15.5,19.1 25.7,29.2 26.4,29.9                    27.1,29.2 29.2,27.1 29.9,26.4 29.2,25.7 "/>                </svg>            </div>            <div class="mece-content-wrapper">                <div class="mece-content">                    <div class="mece-row-container mece-row-container--no-messages">                    </div>                </div>            </div>        </div>          <div id="mece-mobile-cover"></div>',re='<div class="mece-row-container{7}" id="{0}">            <div class="mece-row mece-row--no-margins mece-top-xs"> <!--yksi rivi, jossa kaksi(kolme) kolumnia-->                <div> <!--Column 1 (kuva) flouttaava divi joka asettuu sisaltonsa kokoiseksi-->                    <div class="mece-row-avatar mece-padding">                        <img class="mece-row-avatar-picture" src="{1}">                    </div>                </div>                <div class="mece-col-xs"> <!--Column 2 (sisalto) venyy-->                    <div class="mece-row-content mece-padding">                        <div class="mece-row-content-title mece-h3 mece-text-ellipsis">                            <a target="_blank" href="{2}">{3}</a>                        </div>                        <div class="mece-row-content-para {8}">{4}</div>                        <div class="mece-row-content-received">{5}</div>                    </div>                </div>                <div> <!--flouttaava divi joka asettuu sisaltonsa kokoiseksi-->                    <div class="mece-row-actions">                    </div>                </div>                    <div class="mece-hidden-submitted-time mece-hidden">{6}</div>            </div>        </div>';return{startClient:E}}();