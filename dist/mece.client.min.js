var meceNotifications=function(i){function n(){console.log("controller::init"),i.controller&&!i.controller.initialized&&(i.view&&i.view.initialized?(l=l||i.jQuery,i.pollingInterval=l(i.contentDivId).attr("pollingInterval")||a,i.channels=l(i.contentDivId).attr("meceChannels")||c,e(),i.controller.initialized=!0,console.log("controller::init OK")):i.initializer&&i.initializer.init())}function e(){function i(){l(".dialog").fadeOut(200),l("#meceIcon").removeClass("active")}console.log("controller::dialog"),l("#meceIcon").click(function(i){i.stopPropagation(),l(this).hasClass("active")?(l(".dialog").fadeOut(200),l(this).removeClass("active")):(l(".dialog").delay(100).fadeIn(200),l(this).addClass("active"))}),l(document.body).click(function(n){i()}),l(".dialog").click(function(i){i.stopPropagation()}),o()}function o(){console.log("controller::start"),setInterval(function(){t().then(function(i){var n=JSON.parse(i);n.length>0&&(s=n[n.length-1].received,meceNotifications.view.notifications.add(n.map(function(i){return[i.message,i.link]}))),console.log("Add new notification(s) to the list!")},function(i){console.error("Failed to add new notification(s) to the list!",i)})},a)}function t(){console.log("controller::getNotificationsByChannels");var n=MECE_NOAUTH?{}:{channelNames:i.channels.split(r)};"0"!==s&&(n.startingTime=s);var e=MECE_NOAUTH?MECE_URL+"/channels/"+i.channels+"/notifications?"+l.param(n):MECE_URL+"/notifications?"+l.param(n);return new Promise(function(i,n){var o=new XMLHttpRequest;o.open("GET",e),o.withCredentials=!0,o.onload=function(){200==o.status?i(o.response):n(Error(o.statusText))},o.onerror=function(){n(Error("Network Error"))},o.send()})}var l,a="4000",c="",r=",",s="0";return function(){console.log("controller::bootstrap"),i.controller={init:n,start:o},i.controller.init()}(),i}(meceNotifications||{}),MECE_JQUERY_VERSION="1.4.2",MECE_LOGIN_URL="https://ohtu-devel.it.helsinki.fi/Shibboleth.sso/HYLogin",MECE_URL="http://localhost:1337/mece",MECE_NOAUTH=!1,meceNotifications=function(i){function n(){console.log("initializer::init"),i.initializer&&!i.initializer.initialized&&($=$||i.jQuery,$(i.contentDivId).append("<ul/>"),e(),i.initializer.initialized=!0,console.log("initializer::init OK"))}function e(){if(console.log("initializer::loadJQuery"),void 0===window.jQuery||window.jQuery.fn.jquery!==MECE_JQUERY_VERSION){var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src","https://ajax.googleapis.com/ajax/libs/jquery/"+MECE_JQUERY_VERSION+"/jquery.min.js"),n.readyState?n.onreadystatechange=function(){("complete"==this.readyState||"loaded"==this.readyState)&&o()}:n.onload=o,(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(n)}else i.jQuery=window.jQuery,l()}function o(){console.log("initializer::onJQueryLoaded"),i.jQuery=window.jQuery.noConflict(!0),console.log("onJQueryLoaded:        jQuery.fn.jquery: "+i.jQuery.fn.jquery),console.log("onJQueryLoaded: window.jQuery.fn.jquery: "+window.jQuery.fn.jquery),i.initializer.jqueryLoaded=!0,t()}function t(){console.log("initializer::loginIfWithShibbo"),MECE_NOAUTH?i.view.init():l()}function l(){console.log("initializer::login");var n=document.createElement("iframe");n.style.display="none",n.src=MECE_LOGIN_URL,n.addEventListener("load",function(){setTimeout(function(){console.log("initializer::login OK"),i.view.init()},1e3)},!1),n.addEventListener("error",function(){console.log("initializer::login ERROR")},!1),document.body.appendChild(n)}return i.contentDivId="#mece-content-div",i.iconId="#meceIcon",i.url=MECE_URL,i.jQuery=null,function(){console.log("initializer::bootstrap"),i.initializer={init:n},i.initializer.init()}(),i}(meceNotifications||{}),meceNotifications=function(i){function n(){var n=l("<ul/>").addClass("mece_list").css("background-color","WhiteSmoke").css("color","black");l(i.contentDivId).css("display","none").css("width","500px").css("height","350px").css("overflow","auto").css("border","3px solid navy"),l(i.contentDivId).append(n),l(i.iconId).css("border","3px solid navy").css("height","64px").css("background","#e74c3c").css("padding","0px 32px").css("border-bottom","1px solid #C24032").css("text-align","left").css("box-shadow","0px 0px 4px #C24032")}function e(n,e){var o=l(i.contentDivId).find("ul"),t=l("<a>").attr("href",e[1]).text(e[0]),a=l("<li>").attr("id","MN"+n).css("list-style-image","url('images/"+(n%3>0?"car":"photo")+".png')").css("height","100px").css("border-bottom","1px solid #000").append(t);o.append(a)}function o(){console.log("view::init"),i.view&&!i.view.initialized&&(i.initializer&&i.initializer.jqueryLoaded?(l=l||i.jQuery,n(),i.view.initialized=!0,i.controller.init(),console.log("view::init OK")):i.initializer&&i.initializer.init())}function t(i){console.log("view::add"),l.each(i,function(i,n){e(i,n)}),console.log("view::add OK")}var l;return function(){console.log("view::__bootstrap"),i.view={init:o,notifications:{add:t}},i.view.init()}(),i}(meceNotifications||{});